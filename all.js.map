{"version":3,"sources":["model.js","view.js"],"names":[],"mappings":"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","file":"all.js","sourcesContent":["\"use strict\"\n\nexport const King   = Symbol('King')\nexport const Queen  = Symbol('Queen')\nexport const Rook   = Symbol('Rook')\nexport const Bishop = Symbol('Bishop')\nexport const Knight = Symbol('Knight')\nexport const Pawn   = Symbol('Pawn')\n\nexport const White = Symbol('White')\nexport const Black = Symbol('Black')\n\nexport const Pieces = [King, Queen, Rook, Bishop, Knight, Pawn]\nexport const Sides = [White, Black]\nexport const Ranks = [1, 2, 3, 4, 5, 6, 7, 8]\nexport const Files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h']\n\nexport function createGame(onChange) {\n    let board = (function() {\n        const K = King, Q = Queen, R = Rook, B = Bishop, N = Knight, p = Pawn\n        const w = (piece) => ({ side: White, piece })\n        const b = (piece) => ({ side: Black, piece })\n        return [\n            [w(R), w(N), w(B), w(Q), w(K), w(B), w(N), w(R)],\n            [w(p), w(p), w(p), w(p), w(p), w(p), w(p), w(p)],\n            [null, null, null, null, null, null, null, null],\n            [null, null, null, null, null, null, null, null],\n            [null, null, null, null, null, null, null, null],\n            [null, null, null, null, null, null, null, null],\n            [b(p), b(p), b(p), b(p), b(p), b(p), b(p), b(p)],\n            [b(R), b(N), b(B), b(Q), b(K), b(B), b(N), b(R)],\n        ]\n    })()\n    let turn = White\n\n    function squareIdToIndex(squareId) {\n        return [\n            Ranks.indexOf(squareId[1] | 0),\n            Files.indexOf(squareId[0])\n        ]\n    }\n\n    function getAt(squareId) {\n        const indicies = squareIdToIndex(squareId)\n        return board[indicies[0]][indicies[1]]\n    }\n\n    function setAt(squareId, piece) {\n        const indicies = squareIdToIndex(squareId)\n        board[indicies[0]][indicies[1]] = piece\n    }\n\n    function isValidMove(srcId, destId) {\n        const src = getAt(srcId)\n        const dest = getAt(destId)\n\n        if (!src) return false;\n        if (dest && src.side === dest.side) return false;\n\n        if (!dest) return true;\n        if (dest && src.side !== dest.side) return true;\n\n        return false\n    }\n\n    function move(srcId, destId) {\n        if (!isValidMove(srcId, destId)) throw new Error('Invalid move');\n        setAt(destId, getAt(srcId))\n        setAt(srcId, null)\n        turn = turn === White ? Black : White\n        onChange && onChange()\n    }\n\n    return {\n        getAt,\n        isValidMove,\n        move\n    }\n}\n","\"use strict\"\n\nimport {createGame, Pieces, Sides, Files, Ranks} from 'model'\n\nexport function createView(_document, game) {\n    let activeSquareId = null\n\n    function onDragStart(event) {\n        event.target.classList.add('dragging')\n        activeSquareId = event.target.dataset.squareId\n    }\n\n    function onDragOver(event) {\n        const srcId = activeSquareId\n        const square = event.currentTarget\n        const destId = square.id\n        if (destId && game.isValidMove(srcId, destId)) {\n            event.dataTransfer.dropEffect = 'move'\n            event.preventDefault()\n        }\n    }\n\n    function onDragEnter(event) {\n        const srcId = activeSquareId\n        const square = event.currentTarget\n        const destId = square.id\n        if (destId && game.isValidMove(srcId, destId)) {\n            square.classList.add('dropzone')\n            event.preventDefault()\n        }\n    }\n\n    function onDragLeave(event) {\n        const square = event.currentTarget\n        square.classList.remove('dropzone')\n    }\n\n    function onDrop(event) {\n        const srcId = activeSquareId\n        const square = event.currentTarget\n        const destId = square.id\n        square.classList.remove('dropzone')\n        if (destId && game.isValidMove(srcId, destId)) {\n            game.move(srcId, destId)\n            event.preventDefault()\n        }\n    }\n\n    function onDragEnd(event) {\n        event.target.classList.remove('dragging')\n        activeSquareId = null\n    }\n\n    function getGlyphForPiece(piece) {\n        if (!piece) return '';\n\n        // https://en.wikipedia.org/wiki/Chess_symbols_in_Unicode\n        const pieceOffset = Pieces.indexOf(piece.piece)\n        const sideOffset = Sides.indexOf(piece.side) * 6\n        const base = 9812\n\n        return String.fromCharCode(base + sideOffset + pieceOffset)\n    }\n\n    function render() {\n        for (let file of Files) {\n            for (let rank of Ranks) {\n                const id = file + rank\n                const square = _document.getElementById(id)\n                const glyph = getGlyphForPiece(game.getAt(id))\n                const piece = _document.createElement('span')\n\n                piece.innerHTML = glyph\n                piece.draggable = true\n                piece.dataset.squareId = id\n                piece.ondragstart = onDragStart\n                piece.ondragend = onDragEnd\n\n                square.innerHTML = ''\n                square.appendChild(piece)\n                square.ondragover = onDragOver\n                square.ondragenter = onDragEnter\n                square.ondragleave = onDragLeave\n                square.ondrop = onDrop\n            }\n        }\n    }\n\n    return {\n        render\n    }\n}\n\nexport function initialize() {\n    var onChange = () => view.render()\n    var game = createGame(onChange)\n    var view = createView(document, game)\n\n    view.render()\n    window.game = game\n    window.view = view\n}\n"],"sourceRoot":"/source/"}